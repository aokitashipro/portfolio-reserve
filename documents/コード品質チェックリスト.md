# ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ - ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªå‘ã‘

## ğŸ¯ å„PRä½œæˆå‰ã«å¿…ãšç¢ºèª

---

## 1ï¸âƒ£ ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œãƒã‚§ãƒƒã‚¯

### ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œ

```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç§»å‹•ï¼ˆå„worktreeï¼‰
cd reserve-app

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# Prismaç”Ÿæˆ
npm run prisma:generate

# Lintå®Ÿè¡Œ
npm run lint

# å‹ãƒã‚§ãƒƒã‚¯ï¼‹ãƒ“ãƒ«ãƒ‰
DATABASE_URL="postgresql://dummy:dummy@localhost:5432/dummy" npm run build:ci

# å˜ä½“ãƒ†ã‚¹ãƒˆ
npm test

# E2Eãƒ†ã‚¹ãƒˆ
npm run test:e2e
```

### ã™ã¹ã¦ã‚¨ãƒ©ãƒ¼0ä»¶ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

- âŒ **NG**: 1ã¤ã§ã‚‚ã‚¨ãƒ©ãƒ¼ãŒã‚ã£ãŸã‚‰PRç¦æ­¢
- âœ… **OK**: ã™ã¹ã¦é€šéã—ãŸã‚‰PRå¯èƒ½

---

## 2ï¸âƒ£ ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å“è³ª

### å˜ä½“ãƒ†ã‚¹ãƒˆã®ä¾‹ï¼ˆè‰¯ã„ä¾‹ï¼‰

```typescript
// âœ… GOOD: å…·ä½“çš„ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
describe('BookingCalendar', () => {
  it('é¸æŠã—ãŸæ—¥ä»˜ãŒãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚Œã‚‹', () => {
    render(<BookingCalendar />);
    const dateButton = screen.getByText('20');
    fireEvent.click(dateButton);
    expect(dateButton).toHaveClass('bg-blue-500');
  });

  it('éå»ã®æ—¥ä»˜ã¯é¸æŠã§ããªã„', () => {
    render(<BookingCalendar />);
    const pastDate = screen.getByText('1');
    fireEvent.click(pastDate);
    expect(pastDate).toBeDisabled();
  });

  it('äºˆç´„æ¸ˆã¿ã®æ—¥ä»˜ã¯ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹', async () => {
    const bookedDates = ['2025-01-20'];
    render(<BookingCalendar bookedDates={bookedDates} />);
    const bookedDate = screen.getByText('20');
    expect(bookedDate).toHaveClass('bg-gray-300');
  });
});
```

### E2Eãƒ†ã‚¹ãƒˆã®ä¾‹ï¼ˆè‰¯ã„ä¾‹ï¼‰

```typescript
// âœ… GOOD: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã«æ²¿ã£ãŸæµã‚Œ
test('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒäºˆç´„ã‚’å®Œäº†ã§ãã‚‹', async ({ page }) => {
  // Given: ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿
  await page.goto('/login');
  await page.fill('[name="email"]', 'test@example.com');
  await page.fill('[name="password"]', 'password123');
  await page.click('button[type="submit"]');
  await expect(page).toHaveURL('/');

  // When: äºˆç´„ãƒšãƒ¼ã‚¸ã§æ—¥æ™‚ã‚’é¸æŠ
  await page.goto('/booking');
  await page.click('button:has-text("20")');
  await page.click('button:has-text("14:00")');
  await page.selectOption('select[name="menu"]', 'ã‚«ãƒƒãƒˆ');
  await page.click('button:has-text("äºˆç´„ã‚’ç¢ºå®šã™ã‚‹")');

  // Then: äºˆç´„å®Œäº†ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹
  await expect(page).toHaveURL('/booking/complete');
  await expect(page.locator('h1')).toContainText('äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ');
});
```

---

## 3ï¸âƒ£ TypeScriptå‹å®‰å…¨æ€§

### å‹å®šç¾©ã®ä¾‹ï¼ˆè‰¯ã„ä¾‹ï¼‰

```typescript
// âœ… GOOD: æ˜ç¢ºãªå‹å®šç¾©
export interface Reservation {
  id: string;
  userId: string;
  staffId: string;
  menuId: string;
  reservedDate: Date;
  reservedTime: string;
  status: 'PENDING' | 'CONFIRMED' | 'CANCELLED' | 'COMPLETED';
  notes?: string;
  createdAt: Date;
  updatedAt: Date;
}

// âœ… GOOD: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹
export interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
  };
}

// âœ… GOOD: Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
import { z } from 'zod';

export const reservationSchema = z.object({
  userId: z.string().uuid(),
  menuId: z.string().uuid(),
  staffId: z.string().uuid(),
  reservedDate: z.date(),
  reservedTime: z.string().regex(/^\d{2}:\d{2}$/),
  notes: z.string().optional(),
});

export type ReservationInput = z.infer<typeof reservationSchema>;
```

### é¿ã‘ã‚‹ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// âŒ BAD: anyä½¿ç”¨
const handleSubmit = (data: any) => {
  // ...
};

// âœ… GOOD: å…·ä½“çš„ãªå‹
const handleSubmit = (data: ReservationInput) => {
  // ...
};

// âŒ BAD: å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ä¹±ç”¨
const user = data as User;

// âœ… GOOD: å‹ã‚¬ãƒ¼ãƒ‰
function isUser(data: unknown): data is User {
  return (
    typeof data === 'object' &&
    data !== null &&
    'id' in data &&
    'email' in data
  );
}
```

---

## 4ï¸âƒ£ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### APIãƒ«ãƒ¼ãƒˆã®ä¾‹ï¼ˆè‰¯ã„ä¾‹ï¼‰

```typescript
// app/api/reservations/route.ts
import { NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';
import { reservationSchema } from '@/lib/validations';

export async function POST(request: Request) {
  try {
    // 1. ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£å–å¾—
    const body = await request.json();

    // 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    const validated = reservationSchema.safeParse(body);
    if (!validated.success) {
      return NextResponse.json(
        {
          success: false,
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid input',
            details: validated.error.errors,
          },
        },
        { status: 400 }
      );
    }

    // 3. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    const reservation = await prisma.restaurantReservation.create({
      data: {
        ...validated.data,
        tenantId: process.env.NEXT_PUBLIC_TENANT_ID!,
      },
    });

    // 4. æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
    return NextResponse.json({
      success: true,
      data: reservation,
    });

  } catch (error) {
    // 5. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
    console.error('Reservation creation failed:', error);

    // 6. ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    return NextResponse.json(
      {
        success: false,
        error: {
          code: 'INTERNAL_ERROR',
          message: 'Failed to create reservation',
        },
      },
      { status: 500 }
    );
  }
}
```

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ä¾‹ï¼ˆè‰¯ã„ä¾‹ï¼‰

```typescript
// components/BookingForm.tsx
'use client';

import { useState } from 'react';

export default function BookingForm() {
  const [error, setError] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError(null);
    setLoading(true);

    try {
      const response = await fetch('/api/reservations', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ /* data */ }),
      });

      const result = await response.json();

      if (!result.success) {
        setError(result.error?.message || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        return;
      }

      // æˆåŠŸå‡¦ç†
      alert('äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸ');

    } catch (err) {
      setError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      {error && (
        <div className="bg-red-100 text-red-700 p-4 rounded mb-4">
          {error}
        </div>
      )}
      <button
        type="submit"
        disabled={loading}
        className="bg-blue-500 text-white px-4 py-2 rounded"
      >
        {loading ? 'å‡¦ç†ä¸­...' : 'äºˆç´„ã™ã‚‹'}
      </button>
    </form>
  );
}
```

---

## 5ï¸âƒ£ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ç”»åƒæœ€é©åŒ–

```typescript
// âœ… GOOD: Next.js Imageä½¿ç”¨
import Image from 'next/image';

<Image
  src="/hero.jpg"
  alt="Hero image"
  width={1200}
  height={600}
  priority // LCPå¯¾ç­–
/>

// âŒ BAD: é€šå¸¸ã®img
<img src="/hero.jpg" alt="Hero" />
```

### å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

```typescript
// âœ… GOOD: é‡ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯é…å»¶ãƒ­ãƒ¼ãƒ‰
import dynamic from 'next/dynamic';

const HeavyChart = dynamic(() => import('@/components/HeavyChart'), {
  loading: () => <div>èª­ã¿è¾¼ã¿ä¸­...</div>,
  ssr: false, // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã¿ã§å®Ÿè¡Œ
});
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒæœ€é©åŒ–

```typescript
// âœ… GOOD: ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
export const revalidate = 60; // 60ç§’ã”ã¨ã«å†æ¤œè¨¼

async function getReservations() {
  const data = await prisma.restaurantReservation.findMany({
    where: { tenantId: process.env.NEXT_PUBLIC_TENANT_ID },
    orderBy: { reservedDate: 'desc' },
    take: 10,
  });
  return data;
}
```

---

## 6ï¸âƒ£ ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

### ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯HTML

```typescript
// âœ… GOOD
<nav>
  <ul>
    <li><a href="/">ãƒ›ãƒ¼ãƒ </a></li>
    <li><a href="/booking">äºˆç´„</a></li>
  </ul>
</nav>

<main>
  <h1>äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </h1>
  <section>
    <h2>äºˆç´„ä¸€è¦§</h2>
    {/* ... */}
  </section>
</main>

// âŒ BAD
<div className="nav">
  <div onClick={() => navigate('/')}>ãƒ›ãƒ¼ãƒ </div>
</div>
```

### ARIAå±æ€§

```typescript
// âœ… GOOD: ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³ã«ãƒ©ãƒ™ãƒ«
<button aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã">
  <MenuIcon />
</button>

// âœ… GOOD: ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ©ãƒ™ãƒ«
<label htmlFor="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
<input id="email" type="email" name="email" />
```

### ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ

```typescript
// âœ… GOOD: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆå¯¾å¿œ
<div
  role="button"
  tabIndex={0}
  onClick={handleClick}
  onKeyDown={(e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      handleClick();
    }
  }}
>
  ã‚¯ãƒªãƒƒã‚¯å¯èƒ½
</div>
```

---

## 7ï¸âƒ£ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ç’°å¢ƒå¤‰æ•°

```typescript
// âœ… GOOD: ã‚µãƒ¼ãƒãƒ¼å´ã®ã¿
// app/api/send-email/route.ts
const apiKey = process.env.SENDGRID_API_KEY; // ã‚µãƒ¼ãƒãƒ¼å´ã®ã¿

// âœ… GOOD: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚‚ä½¿ãˆã‚‹
// components/Map.tsx
const publicKey = process.env.NEXT_PUBLIC_MAP_API_KEY;

// âŒ BAD: ç§˜å¯†éµã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ä½¿ç”¨
const secret = process.env.DATABASE_URL; // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ä½¿ã‚ãªã„ï¼
```

### èªè¨¼ãƒã‚§ãƒƒã‚¯

```typescript
// âœ… GOOD: ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ä¿è­·
// middleware.ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  const token = request.cookies.get('auth-token');

  if (!token) {
    return NextResponse.redirect(new URL('/login', request.url));
  }

  return NextResponse.next();
}

export const config = {
  matcher: ['/admin/:path*', '/booking/:path*'],
};
```

---

## 8ï¸âƒ£ ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹é€ 

```typescript
// âœ… GOOD: èª­ã¿ã‚„ã™ã„æ§‹é€ 
'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/Button';

interface BookingFormProps {
  onSubmit: (data: FormData) => void;
}

export default function BookingForm({ onSubmit }: BookingFormProps) {
  // 1. State
  const [date, setDate] = useState<Date | null>(null);
  const [loading, setLoading] = useState(false);

  // 2. Handlers
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    // ...
  };

  // 3. Render
  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      {/* ... */}
      <Button type="submit" disabled={loading}>
        {loading ? 'å‡¦ç†ä¸­...' : 'äºˆç´„ã™ã‚‹'}
      </Button>
    </form>
  );
}
```

### ã‚³ãƒ¡ãƒ³ãƒˆ

```typescript
// âœ… GOOD: å¿…è¦ãªç®‡æ‰€ã«ã®ã¿ã‚³ãƒ¡ãƒ³ãƒˆ
// è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å ´åˆ
function calculateAvailableSlots(date: Date): string[] {
  // å–¶æ¥­æ™‚é–“å†…ã®30åˆ†åˆ»ã¿ã®æ™‚é–“æ ã‚’ç”Ÿæˆ
  // æ—¢å­˜äºˆç´„ã¨é‡è¤‡ã™ã‚‹æ™‚é–“æ ã‚’é™¤å¤–
  const slots = [];
  // ...
  return slots;
}

// âŒ BAD: è‡ªæ˜ãªã‚³ãƒ¡ãƒ³ãƒˆ
// ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
const userId = user.id;
```

---

## 9ï¸âƒ£ Git ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```bash
# âœ… GOOD
feat: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Ÿè£…

- Zodã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
- Supabase Authçµ±åˆ
- E2Eãƒ†ã‚¹ãƒˆè¿½åŠ 

Closes #5

# âœ… GOODï¼ˆãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä½¿ç”¨ï¼‰
fix: äºˆç´„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜é¸æŠãƒã‚°ã‚’ä¿®æ­£
test: äºˆç´„APIã®E2Eãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
docs: README ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã‚’è¿½è¨˜
refactor: BookingFormã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ†å‰²

# âŒ BAD
Update files
Fix bug
WIP
```

---

## ğŸ”Ÿ PRèª¬æ˜æ–‡

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```markdown
## ğŸ“ æ¦‚è¦
ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

## ğŸ¯ é–¢é€£Issue
Closes #5

## âœ… å®Ÿè£…å†…å®¹
- [x] `/register` ãƒšãƒ¼ã‚¸ä½œæˆ
- [x] Supabase Authçµ±åˆ
- [x] Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- [x] E2Eãƒ†ã‚¹ãƒˆè¿½åŠ 
- [x] ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹æ³•
1. `npm run dev` ã§é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
2. http://localhost:3000/register ã«ã‚¢ã‚¯ã‚»ã‚¹
3. ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã—ã¦é€ä¿¡
4. ç¢ºèªãƒ¡ãƒ¼ãƒ«ãŒå±Šãã“ã¨ã‚’ç¢ºèª

## ğŸ–¼ï¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
![ç™»éŒ²ç”»é¢](./screenshots/register.png)

## ğŸ“Š å“è³ªãƒã‚§ãƒƒã‚¯
- [x] ESLintã‚¨ãƒ©ãƒ¼0ä»¶
- [x] TypeScriptã‚¨ãƒ©ãƒ¼0ä»¶
- [x] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ 85%
- [x] E2Eãƒ†ã‚¹ãƒˆé€šé
- [x] Lighthouseã‚¹ã‚³ã‚¢ 95

## ğŸ’¡ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆ
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ãŒé©åˆ‡ã‹
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒååˆ†ã‹
```

---

## ğŸ¯ æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼ˆPRå‰ï¼‰

```bash
# ã™ã¹ã¦å®Ÿè¡Œã—ã¦ç¢ºèª
npm run lint            # âœ… ã‚¨ãƒ©ãƒ¼0ä»¶
npm run build:ci        # âœ… ãƒ“ãƒ«ãƒ‰æˆåŠŸ
npm test               # âœ… ãƒ†ã‚¹ãƒˆé€šé
npm run test:e2e       # âœ… E2Eé€šé

# ã‚³ãƒŸãƒƒãƒˆå‰
git status             # ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹
git diff               # æ„å›³ã—ãªã„å¤‰æ›´ãŒãªã„ã‹
```

---

**ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã¨ã—ã¦ã®å“è³ªã‚’ä¿ã¤ãŸã‚ã€ã™ã¹ã¦ã®é …ç›®ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰PRã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚**
